<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bernhard Clemm">
<meta name="dcterms.date" content="2023-01-03">

<title>Analyis of Web Browsing Data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body>

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#setup-and-warmup" id="toc-setup-and-warmup" class="nav-link active" data-scroll-target="#setup-and-warmup">Setup and warmup</a>
  <ul class="collapse">
  <li><a href="#computational-environment" id="toc-computational-environment" class="nav-link" data-scroll-target="#computational-environment">Computational environment</a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data">Data</a></li>
  <li><a href="#warmup" id="toc-warmup" class="nav-link" data-scroll-target="#warmup">Warmup</a></li>
  </ul></li>
  <li><a href="#pre-processing-browsing-data" id="toc-pre-processing-browsing-data" class="nav-link" data-scroll-target="#pre-processing-browsing-data">Pre-processing browsing data</a>
  <ul class="collapse">
  <li><a href="#parsing-urls" id="toc-parsing-urls" class="nav-link" data-scroll-target="#parsing-urls">Parsing URLs</a>
  <ul class="collapse">
  <li><a href="#extracting-hosts-and-domains" id="toc-extracting-hosts-and-domains" class="nav-link" data-scroll-target="#extracting-hosts-and-domains">Extracting hosts and domains</a></li>
  <li><a href="#extracting-paths-and-queries" id="toc-extracting-paths-and-queries" class="nav-link" data-scroll-target="#extracting-paths-and-queries">Extracting paths and queries</a></li>
  </ul></li>
  <li><a href="#defining-visit-duration" id="toc-defining-visit-duration" class="nav-link" data-scroll-target="#defining-visit-duration">Defining visit duration</a></li>
  <li><a href="#defining-referrals" id="toc-defining-referrals" class="nav-link" data-scroll-target="#defining-referrals">Defining referrals</a></li>
  </ul></li>
  <li><a href="#filtering-browsing-data" id="toc-filtering-browsing-data" class="nav-link" data-scroll-target="#filtering-browsing-data">Filtering browsing data</a>
  <ul class="collapse">
  <li><a href="#missing-visits" id="toc-missing-visits" class="nav-link" data-scroll-target="#missing-visits">Missing visits</a></li>
  <li><a href="#duplicated-visits" id="toc-duplicated-visits" class="nav-link" data-scroll-target="#duplicated-visits">Duplicated visits</a></li>
  <li><a href="#incentivized-visits" id="toc-incentivized-visits" class="nav-link" data-scroll-target="#incentivized-visits">Incentivized visits</a></li>
  </ul></li>
  <li><a href="#classifying-browsing-data" id="toc-classifying-browsing-data" class="nav-link" data-scroll-target="#classifying-browsing-data">Classifying browsing data</a>
  <ul class="collapse">
  <li><a href="#classifying-by-domains-and-hosts" id="toc-classifying-by-domains-and-hosts" class="nav-link" data-scroll-target="#classifying-by-domains-and-hosts">Classifying by domains and hosts</a></li>
  <li><a href="#classifying-by-web-site-titles-or-paths" id="toc-classifying-by-web-site-titles-or-paths" class="nav-link" data-scroll-target="#classifying-by-web-site-titles-or-paths">Classifying by web site titles or paths</a></li>
  </ul></li>
  <li><a href="#modeling-browsing-data" id="toc-modeling-browsing-data" class="nav-link" data-scroll-target="#modeling-browsing-data">Modeling browsing data</a>
  <ul class="collapse">
  <li><a href="#visits--vs-time-based-exposure" id="toc-visits--vs-time-based-exposure" class="nav-link" data-scroll-target="#visits--vs-time-based-exposure">Visits- vs time-based exposure</a></li>
  <li><a href="#accounting-for-skewness" id="toc-accounting-for-skewness" class="nav-link" data-scroll-target="#accounting-for-skewness">Accounting for skewness</a></li>
  <li><a href="#controlling-for-overall-browsing" id="toc-controlling-for-overall-browsing" class="nav-link" data-scroll-target="#controlling-for-overall-browsing">Controlling for overall browsing</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Analyis of Web Browsing Data</h1>
<p class="subtitle lead">Practical code guide</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bernhard Clemm </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 3, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="setup-and-warmup" class="level1">
<h1>Setup and warmup</h1>
<p>This guide walks readers through code implementing the analytical steps described in <span class="citation" data-cites="clemm2023analysis">Clemm von Hohenberg, Stier, et al. (<a href="#ref-clemm2023analysis" role="doc-biblioref">2024</a>)</span> “Analysis of Web Browsing Data: A Guide.” It is a more extended, and periodically updated, version of the Supplementary Materials (Part B) published with the paper. We advise readers to read the paper for more background regarding coding decisions.</p>
<p>We provide code examples in R and SQL. Our first thread of R code follows the <code>tidy</code> style. Our second thread of R coded applies the <code>webtrackR</code> <span class="citation" data-cites="schoch_webtrackr_2023">(<a href="#ref-schoch_webtrackr_2023" role="doc-biblioref">Schoch et al. 2023</a>)</span> package built specifically for web browsing data. Note that since the browsing data set is large, some of the examples may take a while to run in R.</p>

<!-- TO DO: Make tables and plots nice -->
<section id="computational-environment" class="level2">
<h2 class="anchored" data-anchor-id="computational-environment">Computational environment</h2>
<p><strong>R</strong>. To run the R code, you need to install and load the following packages.</p>
<div class="cell" data-hash="index_cache/html/packages_4d814ced87547aa23aa153dfd3680199">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("tidyverse")</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("adaR")</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="do">## install.packages("devtools")</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># devtools::install_github("schochastics/webtrackR")</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("httr2")</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("rvest")</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(adaR)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(webtrackR)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(httr2)</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rvest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The computational environment in which all the below R code was run is the following:</p>
<div class="cell" data-hash="index_cache/html/comp-env-info_10be4f29cfd2dc782488daba11c2cd26">
<div class="cell-output cell-output-stdout">
<pre><code>R version 4.3.1 (2023-06-16)
Platform: x86_64-apple-darwin20 (64-bit)
Running under: macOS Ventura 13.6.1

Matrix products: default
BLAS:   /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRblas.0.dylib 
LAPACK: /Library/Frameworks/R.framework/Versions/4.3-x86_64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0

locale:
[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8

time zone: Europe/Amsterdam
tzcode source: internal

attached base packages:
[1] stats     graphics  grDevices utils     datasets  methods   base     

other attached packages:
 [1] rvest_1.0.3          httr2_0.2.3          webtrackR_0.1.0.9000
 [4] adaR_0.3.0           lubridate_1.9.2      forcats_1.0.0       
 [7] stringr_1.5.1        dplyr_1.1.4          purrr_1.0.2         
[10] readr_2.1.4          tidyr_1.3.0          tibble_3.2.1        
[13] ggplot2_3.4.4        tidyverse_2.0.0     </code></pre>
</div>
</div>
<p><strong>SQL</strong>. All SQL code was run on AWS Athena, but should work with any SQL platform that understands the Presto dialect.</p>
</section>
<section id="data" class="level2">
<h2 class="anchored" data-anchor-id="data">Data</h2>
<p>To run the code, you need, first, a toy browsing data set from our <a href="https://osf.io/m3u9p/">OSF repository</a>. It is based on a real data set collected from a US sample in 2019, but reduced to fewer participants and slightly modified for reasons of anonymity (n<sub>subjects</sub> = 100; n<sub>visits</sub> = 2 million). You can also work with your own data, which should have at least three columns called <code>panelist_id</code>, <code>url</code> and <code>timestamp</code> (in POSIXct format). Our toy data additionally have a variable called <code>wave</code> indicating before which of four fictional survey waves the data was collected, and <code>device</code> indicating whether a visit happened on desktop or mobile. Second, for some of the examples, you also need a survey data set (entirely made up), stored in the same OSF repository.</p>
<p><strong>R</strong>. In R, we can download the data sets directly like this:</p>
<!-- TO DO: Conditional logic for download -->
<div class="cell" data-hash="index_cache/html/data-download_f8fcd50d68ca551929646b65ed60f719">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the test browsing data</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="st">"data/toydt_browsing.rda"</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">"https://osf.io/download/wjd7g/"</span>, <span class="at">destfile =</span> filename)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(filename)</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="co"># load the test survey data</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="st">"data/toydt_survey.rda"</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">"https://osf.io/download/jyfru/"</span>, <span class="at">destfile =</span> filename)</span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(filename)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(filename)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Rename the data sets to distinguish the object we work with in <code>tidy R</code> and with <code>webtrackR</code>.</p>
<div class="cell" data-hash="index_cache/html/data-rename_d1e617048680986955b9a02448eefb03">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># "dt" is the browsing data we work with tidy R</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> toy_browsing</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># "wt" is the browsing data we work with webtrackR</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>wt <span class="ot">&lt;-</span> <span class="fu">as.wt_dt</span>(toy_browsing)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(toy_browsing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>SQL</strong>. If you work with SQL, you can download the data sets with the links provided above, export them as csv files and re-import it as a table into your SQL environment.</p>
</section>
<section id="warmup" class="level2">
<h2 class="anchored" data-anchor-id="warmup">Warmup</h2>
<p>For those less acquainted with computational methods, we begin with some basic examples so that you can familiarize yourself with browsing data. You will still need to install the packages and load the data as described above.</p>
<p>First, let’s get a feeling for the data: How many participants are in the data?</p>
<div class="cell" data-hash="index_cache/html/warmup-1_bec9d414480c0317d92b0bc9ad2f58e1">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>dt_warmup <span class="ot">&lt;-</span> dt</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>dt_warmup <span class="sc">%&gt;%</span> <span class="fu">distinct</span>(panelist_id) <span class="sc">%&gt;%</span> <span class="fu">nrow</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 100</code></pre>
</div>
</div>
<p>What is the number of visits per participant?</p>
<div class="cell" data-hash="index_cache/html/warmup-2_6c9a353b528a3c508278fc99d8c02804">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dt_warmup <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(panelist_id) <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_visits =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 100 × 2
   panelist_id n_visits
   &lt;chr&gt;          &lt;int&gt;
 1 0FcfTn9VDG     18075
 2 1amvqVlZOT      9083
 3 1c4XiaDGYx     14470
 4 1i4XlNVP5E     58650
 5 1wMa7rDJHE     47173
 6 2na1X4OOYs     19852
 7 32Apox0I46    111931
 8 3u7JEyZBdP     12059
 9 4HVpSqa344     60075
10 5ptK95BQBY      3982
# ℹ 90 more rows</code></pre>
</div>
</div>
<p>How many of the visits happened on mobile and on desktop?</p>
<div class="cell" data-hash="index_cache/html/warmup-3_0fbd33b6a713bbcf7572b1c509423ecd">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dt_warmup<span class="sc">$</span>device)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
desktop  mobile 
1453627  618762 </code></pre>
</div>
</div>
<p>What is the time range of the data?</p>
<div class="cell" data-hash="index_cache/html/warmup-4_9ab9eca04f84ebfa5d4fbc569b868ad2">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dt_warmup <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">earliest =</span> <span class="fu">min</span>(<span class="fu">as.Date</span>(timestamp)),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">latest =</span> <span class="fu">max</span>(<span class="fu">as.Date</span>(timestamp)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    earliest     latest
1 2019-03-31 2019-07-31</code></pre>
</div>
</div>
<p>What are top ten domains in the data?</p>
<div class="cell" data-hash="index_cache/html/warmup-5_f969391ed451e0841045e5ebaa304498">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>dt_warmup <span class="ot">&lt;-</span> dt_warmup <span class="sc">%&gt;%</span> </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">domain =</span> adaR<span class="sc">::</span><span class="fu">ada_get_domain</span>(url))</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>dt_warmup <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(domain) <span class="sc">%&gt;%</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 10 × 2
   domain             n
   &lt;chr&gt;          &lt;int&gt;
 1 google.com    361960
 2 facebook.com  133480
 3 yahoo.com     112354
 4 amazon.com     72593
 5 youtube.com    39293
 6 live.com       28393
 7 mlb.com        27072
 8 instagram.com  26533
 9 bing.com       22646
10 reddit.com     21956</code></pre>
</div>
</div>
<p>Let’s aggregate the data to the participant level, counting the number of visits to facebook.com of each participant, and join the survey data to the browsing data. Finally, let’s plot the number of visits to Facebook against participant age. Note that since the age variable was created randomly, we do not see any correlation here.</p>
<div class="cell" data-hash="index_cache/html/warmup-6_cd6dc41935fb8682c5042c7899c99873">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize number of Facebook visits per person</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dt_warmup_agg <span class="ot">&lt;-</span> dt_warmup <span class="sc">%&gt;%</span> </span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">facebook =</span> <span class="fu">ifelse</span>(domain <span class="sc">==</span> <span class="st">"facebook.com"</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(panelist_id) <span class="sc">%&gt;%</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_facebook =</span> <span class="fu">sum</span>(facebook, <span class="at">na.rm =</span> T))</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a><span class="co"># join the survey data to the browsing data.</span></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>dt_warmup_agg <span class="ot">&lt;-</span> dt_warmup_agg <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(., toy_survey, <span class="at">by =</span> <span class="st">"panelist_id"</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the relation of Facebook visits and age</span></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dt_warmup_agg<span class="sc">$</span>age, dt_warmup_agg<span class="sc">$</span>n_facebook)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/warmup-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="pre-processing-browsing-data" class="level1">
<h1>Pre-processing browsing data</h1>
<section id="parsing-urls" class="level2">
<h2 class="anchored" data-anchor-id="parsing-urls">Parsing URLs</h2>
<section id="extracting-hosts-and-domains" class="level3">
<h3 class="anchored" data-anchor-id="extracting-hosts-and-domains">Extracting hosts and domains</h3>
<p><strong>tidy R</strong>. As discussed in the paper’s SM A, the most flexible package to extract domains and hosts is <code>adaR</code> <span class="citation" data-cites="schoch_adar_2023">(<a href="#ref-schoch_adar_2023" role="doc-biblioref">Schoch and Chan 2023</a>)</span>. Often, URLs in web browsing data miss the protocol (“https://”), in which case you need to add it before extracting domain or host. Let’s extract hosts and domains and print a random set of URLs along with extracted host and domain:</p>
<div class="cell" data-hash="index_cache/html/extract-domain-tidyr_1fba457e1bccb448720936533a493fb4">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># add a protocol if necessary</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">protocol =</span> adaR<span class="sc">::</span><span class="fu">ada_get_protocol</span>(url)) <span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">url =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(protocol), <span class="fu">paste0</span>(<span class="st">"https://"</span>, url), url))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the host </span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">host =</span> adaR<span class="sc">::</span><span class="fu">ada_get_host</span>(url))</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the domain </span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">domain =</span> adaR<span class="sc">::</span><span class="fu">ada_get_domain</span>(url))</span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect some results</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">select</span>(url, host, domain) <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                                        url
1                                                                                             https://www.google.com/search
2                                                      https://www.mlb.com/tv/g566223/ve31e0f1a-986b-492a-afe7-614e8153b47f
3 https://www.lordandtaylor.com/shiseido-your-gift-with-any-75-shiseido-purchase-essential-energy-set/product/0500089152901
4                                                                        https://www.instagram.com/stories/lauriehernandez/
5                                      https://docs.google.com/document/d/1HjM902cuQdB1NEeg9BVFfplGP5amgln5cLiyQ5tlppY/edit
                   host            domain
1        www.google.com        google.com
2           www.mlb.com           mlb.com
3 www.lordandtaylor.com lordandtaylor.com
4     www.instagram.com     instagram.com
5       docs.google.com        google.com</code></pre>
</div>
</div>
<p><strong>webtrackR</strong> The <code>webtrackR</code> package wraps functions by <code>adaR</code> and takes care of missing protocols:</p>
<div class="cell" data-hash="index_cache/html/extract-domain-webtrackr_96c0500bdd1e13157b4710b9b2e0c242">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the host </span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>wt <span class="ot">&lt;-</span> <span class="fu">extract_host</span>(wt)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the domain </span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>wt <span class="ot">&lt;-</span> <span class="fu">extract_domain</span>(wt)</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect some results</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>wt <span class="sc">%&gt;%</span> <span class="fu">select</span>(url, host, domain) <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                       url
1 https://opinionsresearch.com/survey/selfserve/58e/a25454
2                    https://www.instagram.com/Roxxsaurus/
3             https://www.beasurveytaker.com/RouterSurvey/
4          https://www.net-research.com/e/425249/index.php
5                 https://www.newegg.com/p/N82E16826814041
                    host               domain
1   opinionsresearch.com opinionsresearch.com
2      www.instagram.com        instagram.com
3 www.beasurveytaker.com   beasurveytaker.com
4   www.net-research.com     net-research.com
5         www.newegg.com           newegg.com</code></pre>
</div>
</div>
<p><strong>SQL</strong>. Presto SQL has an inbuilt function to extract the host:</p>
<div class="cell" data-hash="index_cache/html/extract-domain-sql_7d4cee91a67a93aaf31e368875424577">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span>, URL_EXTRACT_HOST(url)) <span class="kw">AS</span> host</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For domain extraction, it has no inbuilt function. One approach could be to upload the list of public suffixes as an SQL table, then to split up the URL host at every dot into parts; then to put the parts together incrementally, starting from the last part; finally match the resulting combinations to suffixes from the Public Suffix List. This strategy is explained in detail in <a href="https://bernhard-clemm.medium.com/how-to-extract-domains-in-aws-athena-presto-sql-7f679dbcac72">this blog post</a>. However, it is quite cumbersome, and the simpler approach is to download the list of unique hosts, extract the domains with the packages described above, and upload the table into the SQL database.</p>
</section>
<section id="extracting-paths-and-queries" class="level3">
<h3 class="anchored" data-anchor-id="extracting-paths-and-queries">Extracting paths and queries</h3>
<p><strong>tidy R</strong>. Let’s extract paths and query and print a random set of URLs along with extracted paths and query:</p>
<div class="cell" data-hash="index_cache/html/extract-path-tidyr_ef7720f73e69ba997aa475ebfacdc77a">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the path </span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">path =</span> adaR<span class="sc">::</span><span class="fu">ada_get_pathname</span>(url))</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the query </span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">query =</span> adaR<span class="sc">::</span><span class="fu">ada_get_search</span>(url))</span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect some results</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> <span class="fu">select</span>(url, path, query) <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                     url
1                                                 https://account.microsoft.com/rewards/
2                                                   https://www.amazon.com/dp/1683370759
3                                 https://kelly--c.visualforce.com/apex/CandExpJobSearch
4 https://jezebel.com/prison-might-be-pretty-embarrassing-for-the-varsity-blu-1834442677
5                                http://adserver.entertainow.com/promo/LHCwn3f9oCbAlnHY/
                                                                 path query
1                                                           /rewards/      
2                                                      /dp/1683370759      
3                                              /apex/CandExpJobSearch      
4 /prison-might-be-pretty-embarrassing-for-the-varsity-blu-1834442677      
5                                            /promo/LHCwn3f9oCbAlnHY/      </code></pre>
</div>
</div>
<p><strong>webtrackR</strong>. The package has a function for extracting the path, not yet one for extracting the query:</p>
<div class="cell" data-hash="index_cache/html/extract-path-webtrackr_fb9f4d5eceb0f38cf5d871d75110d196">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># extract the path </span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>wt <span class="ot">&lt;-</span> <span class="fu">extract_path</span>(wt)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect some results</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>wt <span class="sc">%&gt;%</span> <span class="fu">select</span>(url, path) <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                 url
1 https://www.offroadexpo.com/video-scottsdale-off-road-expo-presented-by-nitto-2017
2                                                          https://www.facebook.com/
3                                           https://www.instagram.com/candancesmith/
4                                             https://www.creditkarma.com/auth/logon
5                                   https://accounts.google.com/signin/v2/identifier
                                                     path
1 /video-scottsdale-off-road-expo-presented-by-nitto-2017
2                                                       /
3                                         /candancesmith/
4                                             /auth/logon
5                                   /signin/v2/identifier</code></pre>
</div>
</div>
<p>Additionally, <code>webtrackR</code> allows users to parse the path if it contains a human-readable string. As described in Section 4.3 of the paper, this information can be used for further classification. Since URL paths contain many non-human-readable strings, the package allows to specify whether to only keep strings consisting of letters, or only those consisting of English words:</p>
<div class="cell" data-hash="index_cache/html/parse-path-webtrackr_29b42904e7336a0f62f9e3e933212f7c">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># parse the paths into human-readable text</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>wt <span class="ot">&lt;-</span> <span class="fu">parse_path</span>(wt, <span class="at">varname =</span> <span class="st">"url"</span>, <span class="at">keep =</span> <span class="st">"letters_only"</span>)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect some results</span></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>wt <span class="sc">%&gt;%</span> <span class="fu">select</span>(url, path, path_split) <span class="sc">%&gt;%</span> <span class="fu">sample_n</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                         url
1       https://docs.google.com/document/d/10zjeUc3kJmgr49lmjnbZYBwfcKQ83sYVaS8SN6twFpg/edit
2                                                          https://mail.google.com/mail/u/0/
3 https://photos.google.com/search/May 25/photo/AF1QipMbW-Zj7WErhF4WVZP87Y0VrVFfrX3F-zQRSKT6
4        https://www.facebook.com/kentuckianahumor/photos/a.180682925896636/267987777166150/
5                                                              https://www.google.com/search
                                                               path
1     /document/d/10zjeUc3kJmgr49lmjnbZYBwfcKQ83sYVaS8SN6twFpg/edit
2                                                        /mail/u/0/
3 /search/May 25/photo/AF1QipMbW-Zj7WErhF4WVZP87Y0VrVFfrX3F-zQRSKT6
4       /kentuckianahumor/photos/a.180682925896636/267987777166150/
5                                                           /search
                 path_split
1           document,d,edit
2                    mail,u
3              search,photo
4 kentuckianahumor,photos,a
5                    search</code></pre>
</div>
</div>
<p><strong>SQL</strong>. Presto SQL has inbuilt-functions to extract path and query:</p>
<div class="cell" data-hash="index_cache/html/extract-path-sql_ac94b429ca46381883ed9e970157c2a1">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span>, URL_EXTRACT_PATH(url)) <span class="kw">AS</span> path, URL_EXTRACT_QUERY(url)) <span class="kw">AS</span> <span class="kw">query</span> </span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="defining-visit-duration" class="level2">
<h2 class="anchored" data-anchor-id="defining-visit-duration">Defining visit duration</h2>
<p><strong>tidy R</strong>. The following code creates a timestamp-based duration variable, with a cutoff of 300 seconds and setting differences exceeding it to <code>NA</code>. Further, the visit before a device switch, as well as the last visit of a person, is set to <code>NA</code>.</p>
<div class="cell" data-hash="index_cache/html/duration-tidyr_cc69d425dca141796778aae994b0ce73">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define cutoff and replacement</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>cutoff <span class="ot">&lt;-</span> <span class="dv">300</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>replacement <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a><span class="co"># create "next" timestamp and "next" device</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(panelist_id) <span class="sc">%&gt;%</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timestamp_next =</span> <span class="fu">lead</span>(timestamp, <span class="at">order_by =</span> timestamp),</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">device_next =</span> <span class="fu">lead</span>(device, <span class="at">order_by =</span> timestamp)) </span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="co"># create timestamp-based difference</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> </span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(panelist_id, timestamp) <span class="sc">%&gt;%</span> </span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># compute raw time difference between timestamps</span></span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timediff =</span> timestamp_next <span class="sc">-</span> timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set time difference to NA at device switch</span></span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timediff =</span> <span class="fu">ifelse</span>(device <span class="sc">!=</span> device_next, <span class="cn">NA</span>, timediff)) <span class="sc">%&gt;%</span></span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># set duration to time difference unless exceeding cutoff</span></span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">duration =</span> <span class="fu">ifelse</span>(timediff <span class="sc">&gt;</span> cutoff, <span class="cn">NA</span>, timediff)) <span class="sc">%&gt;%</span></span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(timestamp_next, device_next, timediff))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>webtrackR</strong>. The package wraps this logic in a function. It allows to set the cutoff value, the replacement value, and whether the duration before a device switch should be set to <code>NA</code>.</p>
<div class="cell" data-hash="index_cache/html/duration-webtrackr_aa7698a99348049f6363fdc7f16d0fbf">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>wt <span class="ot">&lt;-</span> <span class="fu">add_duration</span>(</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  wt, <span class="at">cutoff =</span> <span class="dv">300</span>, <span class="at">replace_by =</span> <span class="cn">NA</span>, </span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">device_switch_na =</span> F, <span class="at">device_var =</span> <span class="st">"device"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>SQL</strong>. In Presto SQL, the same can be done with the following:</p>
<div class="cell" data-hash="index_cache/html/duration-sql_71ead3c3b1c46e50d5750bab2807df30">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> panelist_id, wave, <span class="dt">timestamp</span>, url, device,</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co">-- set duration to time difference unless exceeding cutoff, or before device switch</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a><span class="cf">CASE</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="cf">WHEN</span> device <span class="op">!=</span> device_next <span class="cf">THEN</span> <span class="kw">NULL</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a><span class="cf">WHEN</span> date_diff(<span class="st">'second'</span>, <span class="dt">timestamp</span>, timestamp_next) <span class="op">&gt;</span> <span class="dv">300</span> <span class="cf">THEN</span> <span class="kw">NULL</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="cf">ELSE</span> date_diff(<span class="st">'second'</span>, <span class="dt">timestamp</span>, timestamp_next)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> <span class="kw">AS</span> duration</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> <span class="op">*</span>,</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a><span class="co">-- create "next" timestamp and "next" device</span></span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a><span class="fu">LEAD</span>(<span class="dt">timestamp</span>) <span class="kw">OVER</span>(<span class="kw">PARTITION</span> <span class="kw">BY</span> panelist_id <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">timestamp</span>) <span class="kw">AS</span> timestamp_next,</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a><span class="fu">LEAD</span>(device) <span class="kw">OVER</span>(<span class="kw">PARTITION</span> <span class="kw">BY</span> panelist_id <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">timestamp</span>) <span class="kw">AS</span> device_next</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> guide_testdata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="defining-referrals" class="level2">
<h2 class="anchored" data-anchor-id="defining-referrals">Defining referrals</h2>
<p><strong>tidy R</strong>. The below code examples implements the approach judged as optimal by <span class="citation" data-cites="schmidt_mangold_stier_ulloa">Schmidt et al. (<a href="#ref-schmidt_mangold_stier_ulloa" role="doc-biblioref">2023</a>)</span>: A visit is defined as referred by a platform (e.g., Facebook) when it directly follows a visit to that platform and contains a certain pattern in its URL (e.g., “fbclid=”).</p>
<div class="cell" data-hash="index_cache/html/referrals-tidyr_1ffb838cc7ec0557a5783000208ea2ae">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># the following assumes you have extracted the domain already</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># get previous domain</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(panelist_id) <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">domain_previous =</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(domain, <span class="at">order_by =</span> timestamp)) <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># flag referral</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">referral =</span> <span class="fu">ifelse</span>(domain_previous <span class="sc">==</span> <span class="st">"facebook.com"</span> <span class="sc">&amp;</span> <span class="fu">grepl</span>(<span class="st">"fbclid="</span>, url), <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(domain_previous))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>webtrackR</strong>. The package implements the logic in a function that extracts the previous domain automatically and also allows getting referrals for multiple platforms/patterns:</p>
<div class="cell" data-hash="index_cache/html/referrals-webtrackr_5f51db0a08bac1d8b51d0975298b8019">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>wt <span class="ot">&lt;-</span> <span class="fu">add_referral</span>(wt, <span class="at">platform_domains =</span> <span class="st">"facebook.com"</span>, <span class="at">patterns =</span> <span class="st">"fbclid="</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>SQL</strong>. The same approach would work as follows in Presto SQL, assuming the domain has been extracted:</p>
<div class="cell" data-hash="index_cache/html/referrals-sql_6f824b60b5965f1b800759108415371c">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span>, </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="cf">CASE</span> </span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="cf">WHEN</span> <span class="fu">regexp_like</span>(<span class="st">'fbclid='</span>, url) <span class="kw">AND</span> domain_previous <span class="op">=</span> <span class="st">'facebook.com'</span> <span class="cf">THEN</span> <span class="dv">1</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="cf">ELSE</span> <span class="dv">0</span> </span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> <span class="kw">AS</span> referral</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> url, <span class="dt">timestamp</span>, </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="fu">lag</span>(<span class="kw">domain</span>) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> panelist_id <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">timestamp</span>) <span class="kw">AS</span> domain_previous</span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> dt)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="filtering-browsing-data" class="level1">
<h1>Filtering browsing data</h1>
<section id="missing-visits" class="level2">
<h2 class="anchored" data-anchor-id="missing-visits">Missing visits</h2>
<p><strong>R</strong>. For each participant, we can compute the proportion of the span of active days (i.e., the number of days between the first and last day of data for that person) out of the potential maximum of days (i.e., the difference between the first and last day of data collection). If this proportion is small, it could be an indication of missingness—of course, given certain theoretical assumptions. As the histogram below shows, there are indeed some subjects for which the proportion is small.</p>
<div class="cell" data-hash="index_cache/html/missing-tidyR_7a7567e3024242f0cdb49379f41d7d6e">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># define the maximum span of days as difference between first and last day</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>max_days <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">max</span>(<span class="fu">as.Date</span>(dt<span class="sc">$</span>timestamp)) <span class="sc">-</span> <span class="fu">min</span>(<span class="fu">as.Date</span>(dt<span class="sc">$</span>timestamp)))</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co"># summarize per person</span></span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>person_summary <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(timestamp)) <span class="sc">%&gt;%</span></span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(panelist_id, date) <span class="sc">%&gt;%</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_visits =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(panelist_id) <span class="sc">%&gt;%</span></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">earliest =</span> <span class="fu">as.Date</span>(<span class="fu">min</span>(date)),</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">latest =</span> <span class="fu">as.Date</span>(<span class="fu">max</span>(date))) <span class="sc">%&gt;%</span></span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">span_days =</span> <span class="fu">as.numeric</span>(latest <span class="sc">-</span> earliest) <span class="sc">+</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">proportion =</span> span_days <span class="sc">/</span> max_days)</span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect the resulting proportion</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(person_summary<span class="sc">$</span>proportion, <span class="at">breaks =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/missing-tidyR-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>SQL</strong>. The same can be achieved in Presto as follows:</p>
<div class="cell" data-hash="index_cache/html/missing-sql_2c2a6e1ac908ea247d62fcfd9c01b4f3">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- define the maximum span of days as difference between first and last day: 122</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="fu">MAX</span>(<span class="dt">DATE</span>(<span class="dt">timestamp</span>)) <span class="op">-</span> <span class="fu">MIN</span>(<span class="dt">DATE</span>(<span class="dt">timestamp</span>)) </span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> dt</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a><span class="co">-- summarize per person </span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> panelist_id, earliest, latest,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>DATE_DIFF(<span class="st">'day'</span>, earliest, latest) <span class="kw">AS</span> span_days,</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="fu">CAST</span>(DATE_DIFF(<span class="st">'day'</span>, earliest, latest) <span class="kw">AS</span> <span class="dt">REAL</span>) <span class="op">/</span> max_days <span class="kw">AS</span> proportion</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> panelist_id,</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="fu">MIN</span>(<span class="dt">DATE</span>(<span class="dt">timestamp</span>)) earliest, <span class="fu">MAX</span>(<span class="dt">DATE</span>(<span class="dt">timestamp</span>)) latest, <span class="dv">122</span> <span class="kw">as</span> max_days</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> panelist_id, <span class="dt">timestamp</span>, <span class="fu">COUNT</span>() n_visits</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> dt</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> wave <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> panelist_id, <span class="dt">timestamp</span>)</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> panelist_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="duplicated-visits" class="level2">
<h2 class="anchored" data-anchor-id="duplicated-visits">Duplicated visits</h2>
<p>As we describe in the main paper, duplicates can be defined in several ways: as sequential visits to the same URL, after removing the URL’s fragment <span class="citation" data-cites="Guess2021">(<a href="#ref-Guess2021" role="doc-biblioref">Guess 2021</a>)</span>; as visits to the same URL within the same day <span class="citation" data-cites="wojcieszak2022null">(<a href="#ref-wojcieszak2022null" role="doc-biblioref">Wojcieszak et al. 2022</a>)</span>; or as sequential visits to the same URL that happen within one second. Alternatively, one can aggregate the duration of sequential visits to the same URL <span class="citation" data-cites="stier.apsr.2022">(<a href="#ref-stier.apsr.2022" role="doc-biblioref">Stier et al. 2022</a>)</span>.</p>
<p><strong>tidy R</strong>. The four methods can be applied to the data the following way:</p>
<div class="cell" data-hash="index_cache/html/duplicated-tidyr_a134b215c1c56cee1f0a32983d0bbe7c">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Guess 2021</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">protocol =</span> <span class="fu">ada_get_protocol</span>(url),</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">host =</span> <span class="fu">ada_get_host</span>(url),</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">path =</span> <span class="fu">ada_get_pathname</span>(url),</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">query =</span> <span class="fu">ada_get_search</span>(url),</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">fragment =</span> <span class="fu">ada_get_hash</span>(url))  <span class="sc">%&gt;%</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># construct URL without fragment</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">url_without_fragment =</span> <span class="fu">paste0</span>(protocol, host, path, query)) <span class="sc">%&gt;%</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(protocol, fragment)) <span class="sc">%&gt;%</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(panelist_id, timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(panelist_id) <span class="sc">%&gt;%</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># previous URL without fragment</span></span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">url_prev_without_fragment =</span> <span class="fu">lag</span>(url_without_fragment, <span class="at">order_by =</span> timestamp),</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">person_visit_rank =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if the previous URL is the same, then duplicate</span></span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dupl_guess =</span> <span class="fu">ifelse</span>(url_without_fragment <span class="sc">==</span> url_prev_without_fragment, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ... and the first visit of a person is 0, rather than NA </span></span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dupl_guess =</span> <span class="fu">ifelse</span>(person_visit_rank <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>, dupl_guess)) <span class="sc">%&gt;%</span></span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(url_prev_without_fragment, url_without_fragment))</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a><span class="co"># Wojcieszak et al 2022</span></span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">as.Date</span>(timestamp)) <span class="sc">%&gt;%</span></span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(panelist_id, date, timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(panelist_id, date, url) <span class="sc">%&gt;%</span></span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>  <span class="co"># give unique number for URLs per date/person</span></span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rep_number =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>  <span class="co"># any URL that has been visited already by person that day is duplicate</span></span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dupl_wojc =</span> <span class="fu">ifelse</span>(rep_number <span class="sc">&gt;</span> <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(date, rep_number))</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-35"><a href="#cb36-35" aria-hidden="true" tabindex="-1"></a><span class="co"># sequential visits to the same URL that happen within one second</span></span>
<span id="cb36-36"><a href="#cb36-36" aria-hidden="true" tabindex="-1"></a>cutoff <span class="ot">&lt;-</span> <span class="dv">1</span> </span>
<span id="cb36-37"><a href="#cb36-37" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb36-38"><a href="#cb36-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(panelist_id, timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb36-39"><a href="#cb36-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(panelist_id) <span class="sc">%&gt;%</span></span>
<span id="cb36-40"><a href="#cb36-40" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">timestamp_prev =</span> <span class="fu">lag</span>(timestamp, <span class="at">order_by =</span> timestamp),</span>
<span id="cb36-41"><a href="#cb36-41" aria-hidden="true" tabindex="-1"></a>         <span class="at">url_prev =</span> <span class="fu">lag</span>(url, <span class="at">order_by =</span> timestamp),</span>
<span id="cb36-42"><a href="#cb36-42" aria-hidden="true" tabindex="-1"></a>         <span class="at">person_visit_rank =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb36-43"><a href="#cb36-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-44"><a href="#cb36-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">created_diff =</span> <span class="fu">difftime</span>(timestamp, timestamp_prev)) <span class="sc">%&gt;%</span></span>
<span id="cb36-45"><a href="#cb36-45" aria-hidden="true" tabindex="-1"></a>  <span class="co"># if previous URL is the same and within one sec, then duplicate</span></span>
<span id="cb36-46"><a href="#cb36-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dupl_onesec =</span> <span class="fu">ifelse</span>((url <span class="sc">==</span> url_prev <span class="sc">&amp;</span> created_diff <span class="sc">&lt;=</span> cutoff), <span class="dv">1</span>, <span class="dv">0</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb36-47"><a href="#cb36-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dupl_onesec =</span> <span class="fu">ifelse</span>(person_visit_rank <span class="sc">==</span> <span class="dv">1</span>, <span class="dv">0</span>, dupl_onesec)) <span class="sc">%&gt;%</span></span>
<span id="cb36-48"><a href="#cb36-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(timestamp_prev, url_prev, person_visit_rank, created_diff))</span>
<span id="cb36-49"><a href="#cb36-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-50"><a href="#cb36-50" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate duration of sequential visits to the same URL</span></span>
<span id="cb36-51"><a href="#cb36-51" aria-hidden="true" tabindex="-1"></a>dt_agged <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb36-52"><a href="#cb36-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(panelist_id, timestamp) <span class="sc">%&gt;%</span></span>
<span id="cb36-53"><a href="#cb36-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(panelist_id) <span class="sc">%&gt;%</span></span>
<span id="cb36-54"><a href="#cb36-54" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">url_group =</span> <span class="fu">cumsum</span>(url <span class="sc">!=</span> <span class="fu">lag</span>(url, <span class="at">def =</span> <span class="fu">first</span>(url)))) <span class="sc">%&gt;%</span></span>
<span id="cb36-55"><a href="#cb36-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(panelist_id, wave, url, url_group) <span class="sc">%&gt;%</span></span>
<span id="cb36-56"><a href="#cb36-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">agg_duration =</span> <span class="fu">sum</span>(duration, <span class="at">na.rm =</span> T),</span>
<span id="cb36-57"><a href="#cb36-57" aria-hidden="true" tabindex="-1"></a>            <span class="at">timestamp_first =</span> <span class="fu">min</span>(timestamp, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb36-58"><a href="#cb36-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb36-59"><a href="#cb36-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-60"><a href="#cb36-60" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect the resulting duplicate proportions</span></span>
<span id="cb36-61"><a href="#cb36-61" aria-hidden="true" tabindex="-1"></a>dt <span class="sc">%&gt;%</span> </span>
<span id="cb36-62"><a href="#cb36-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">prop_dupl_guess =</span> <span class="fu">sum</span>(dupl_guess, <span class="at">na.rm =</span> T) <span class="sc">/</span> <span class="fu">n</span>(),</span>
<span id="cb36-63"><a href="#cb36-63" aria-hidden="true" tabindex="-1"></a>            <span class="at">prop_dupl_wojc =</span> <span class="fu">sum</span>(dupl_wojc, <span class="at">na.rm =</span> T) <span class="sc">/</span> <span class="fu">n</span>(),</span>
<span id="cb36-64"><a href="#cb36-64" aria-hidden="true" tabindex="-1"></a>            <span class="at">prop_dupl_onesec =</span> <span class="fu">sum</span>(dupl_onesec, <span class="at">na.rm =</span> T) <span class="sc">/</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 3
  prop_dupl_guess prop_dupl_wojc prop_dupl_onesec
            &lt;dbl&gt;          &lt;dbl&gt;            &lt;dbl&gt;
1           0.395          0.662            0.139</code></pre>
</div>
</div>
<p><strong>webtrackR</strong>. The package implements both the logic of treating sequential visits to the same URL that happen within one second as duplicates. It also allows users aggregation of consecutive visits to the same URL.</p>
<div class="cell" data-hash="index_cache/html/duplicated-webtrackr_59cf84a008d7a5a4e589dafb220f795d">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># flagging duplicates within one second</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>wt_dedup <span class="ot">&lt;-</span> <span class="fu">deduplicate</span>(wt, <span class="at">method =</span> <span class="st">"flag"</span>, <span class="at">within =</span> <span class="dv">1</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># dropping duplicates within one second</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>wt_dedup <span class="ot">&lt;-</span> <span class="fu">deduplicate</span>(wt, <span class="at">method =</span> <span class="st">"drop"</span>, <span class="at">within =</span> <span class="dv">1</span>)</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate duration of sequential visits to the same URL</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>wt_dedup <span class="ot">&lt;-</span> <span class="fu">deduplicate</span>(wt, <span class="at">method =</span> <span class="st">"aggregate"</span>, <span class="at">keep_nvisits =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>SQL</strong>. Flagging/dropping duplicates defined as sequential visits within the same second, as well as aggregating the duration of sequential visits would work as follows in SQL:</p>
<div class="cell" data-hash="index_cache/html/duplicated-sql_b397c0627b7dbb3d35bf2723557a4ddd">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- flagging duplicates within one second</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span>,</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="cf">CASE</span> </span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="cf">WHEN</span> timestamp_prev <span class="kw">IS</span> <span class="kw">NULL</span> <span class="cf">THEN</span> <span class="kw">FALSE</span></span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="cf">WHEN</span> date_diff(<span class="st">'second'</span>, timestamp_prev, <span class="dt">timestamp</span>) <span class="op">&lt;=</span> <span class="dv">1</span> <span class="kw">AND</span> url <span class="op">=</span> url_prev <span class="cf">THEN</span> <span class="kw">TRUE</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="cf">ELSE</span> <span class="kw">FALSE</span></span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> <span class="kw">AS</span> duplicate</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> panelist_id,  </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a><span class="dt">timestamp</span>, <span class="fu">LAG</span>(<span class="dt">timestamp</span>) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> panelist_id <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">timestamp</span>) <span class="kw">AS</span> timestamp_prev, </span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>url, <span class="fu">LEAD</span>(url) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> panelist_id <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">timestamp</span>) <span class="kw">AS</span> url_prev</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> dt)</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co">-- dropping duplicates within one second</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> <span class="op">*</span> <span class="kw">FROM</span></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> <span class="op">*</span>,</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a><span class="cf">CASE</span> </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a><span class="cf">WHEN</span> timestamp_prev <span class="kw">IS</span> <span class="kw">NULL</span> <span class="cf">THEN</span> <span class="kw">FALSE</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a><span class="cf">WHEN</span> date_diff(<span class="st">'second'</span>, timestamp_prev, <span class="dt">timestamp</span>) <span class="op">&lt;=</span> <span class="dv">1</span> <span class="kw">AND</span> url <span class="op">=</span> url_prev <span class="cf">THEN</span> <span class="kw">TRUE</span></span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a><span class="cf">ELSE</span> <span class="kw">FALSE</span></span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> <span class="kw">AS</span> duplicate</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> panelist_id,  </span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a><span class="dt">timestamp</span>, <span class="fu">LAG</span>(<span class="dt">timestamp</span>) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> panelist_id <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">timestamp</span>) <span class="kw">AS</span> timestamp_prev, </span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>url, <span class="fu">LEAD</span>(url) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> panelist_id <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">timestamp</span>) <span class="kw">AS</span> url_prev</span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> dt))</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a><span class="kw">WHERE</span> duplicate <span class="op">=</span> <span class="kw">TRUE</span></span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a><span class="co">-- aggregate duration of sequential visits to the same URL (assuming duration is extracted)</span></span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(duration) <span class="kw">AS</span> agg_duration, <span class="fu">MIN</span>(<span class="dt">timestamp</span>) <span class="kw">AS</span> timestamp_first</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> <span class="op">*</span>, </span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a><span class="fu">SUM</span>(new_url) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> panelist_id <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">timestamp</span>) url_group</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> <span class="op">*</span></span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a><span class="cf">CASE</span> </span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a><span class="cf">WHEN</span> url_no_query <span class="op">=</span> <span class="fu">LAG</span>(url_no_query) <span class="kw">OVER</span> (<span class="kw">PARTITION</span> <span class="kw">BY</span> panelist_id <span class="kw">ORDER</span> <span class="kw">BY</span> <span class="dt">timestamp</span>) <span class="cf">THEN</span> <span class="dv">0</span></span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a><span class="cf">ELSE</span> <span class="dv">1</span> </span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> <span class="kw">AS</span> new_url</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> dt </span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a><span class="kw">ORDER</span> <span class="kw">BY</span> panelist_id, <span class="dt">timestamp</span>))</span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a><span class="kw">GROUP</span> <span class="kw">BY</span> panelist_id, wave, url, url_group</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="incentivized-visits" class="level2">
<h2 class="anchored" data-anchor-id="incentivized-visits">Incentivized visits</h2>
<p><strong>R</strong>. To identify survey visits, you can use the list of hosts identified by <span class="citation" data-cites="clemm2024survey">Clemm von Hohenberg, Ventura, et al. (<a href="#ref-clemm2024survey" role="doc-biblioref">2024</a>)</span>, which includes three types of entries: (1) hosts containing the word “survey”; (2) hosts matching the address of questionnaires platforms listed in a report by <span class="citation" data-cites="bevec2021websm">Bevec and Vehovar (<a href="#ref-bevec2021websm" role="doc-biblioref">2021</a>)</span>; (3) those among the most frequented hosts identified as survey sites. Hence, this list is quite specific to the data analyzed in <span class="citation" data-cites="clemm2024survey">Clemm von Hohenberg, Ventura, et al. (<a href="#ref-clemm2024survey" role="doc-biblioref">2024</a>)</span>. For example, in your data set that there may be other URL hosts containing the word “survey” not on our list. Thus, a more rigorous approach would be reproduce the approach on your own data set.</p>
<!-- TO DO: MORE SOPHISTICATED IDENTIFDICATION -->
<div class="cell" data-hash="index_cache/html/incentivized-r_f45b910c9ac9bf86ee0c05ccdea72871">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># download the list from OSF</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>filename <span class="ot">&lt;-</span> <span class="st">"data/survey-click2earn-hosts.csv"</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">download.file</span>(<span class="at">url =</span> <span class="st">"https://osf.io/download/dw6cq/"</span>, <span class="at">destfile =</span> filename)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>survey_click2earn_hosts <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(filename)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(filename)</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a><span class="co"># match the list to the browsing data (assumes that host is already extracted)</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., survey_click2earn_hosts, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">"host"</span> <span class="ot">=</span> <span class="st">"url_host"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">survey_flag =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(method), T, F))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>SQL</strong>. This would translate to Presto the following way, assuming the list of survey hosts is uploaded as a table:</p>
<div class="cell" data-hash="index_cache/html/incentivized-sql_c7fdd4e04524d947378986abc4cc5be1">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode sql code-with-copy"><code class="sourceCode sql"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co">-- join tracking data to list of survey hosts and flag visits</span></span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">SELECT</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>d.url, d.url_host, s.<span class="kw">method</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="cf">CASE</span> </span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="cf">WHEN</span> s.<span class="kw">method</span> <span class="kw">IS</span> <span class="kw">NOT</span> <span class="kw">NULL</span> <span class="cf">THEN</span> <span class="kw">TRUE</span> </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="cf">ELSE</span> <span class="kw">FALSE</span></span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="cf">END</span> <span class="kw">AS</span> survey_flag</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span></span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>(<span class="kw">SELECT</span> <span class="op">*</span>, URL_EXTRACT_HOST(url) <span class="kw">as</span> url_host</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="kw">FROM</span> dat) d</span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="kw">LEFT</span> <span class="kw">JOIN</span> survey_click2earn_hosts s <span class="kw">ON</span> d.url_host <span class="op">=</span> s.url_host</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="classifying-browsing-data" class="level1">
<h1>Classifying browsing data</h1>
<p>Many of the following operations require more coding flexibility, so we now proceed entirely in R.</p>
<section id="classifying-by-domains-and-hosts" class="level2">
<h2 class="anchored" data-anchor-id="classifying-by-domains-and-hosts">Classifying by domains and hosts</h2>
<p><strong>R</strong>. To exemplify, we match the list of news sites by <span class="citation" data-cites="wojcieszak2023non">Wojcieszak et al. (<a href="#ref-wojcieszak2023non" role="doc-biblioref">2023</a>)</span> to the browsing data. Since not all of the news sites consist of a domain, but some also have a path (e.g., “yahoo.com/news”), we first need to split them up in two:</p>
<div class="cell" data-hash="index_cache/html/classify-lists-r_3c5c6a19cd5a90ec2880f893cfc6ff3e">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>url <span class="ot">&lt;-</span> <span class="st">"https://raw.githubusercontent.com/ercexpo/us-news-domains/main/us-news-domains-v2.0.0.csv"</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>news_list <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(url)</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a><span class="do">### Check which ones of our news sites are defined by domain only, which more than domain</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>news_list <span class="ot">&lt;-</span> news_list <span class="sc">%&gt;%</span></span>
<span id="cb42-6"><a href="#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">"domain_old"</span> <span class="ot">=</span> domain) <span class="sc">%&gt;%</span></span>
<span id="cb42-7"><a href="#cb42-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">https_domain =</span> <span class="fu">paste0</span>(<span class="st">"https://"</span>, domain_old)) <span class="sc">%&gt;%</span></span>
<span id="cb42-8"><a href="#cb42-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">domain =</span> adaR<span class="sc">::</span><span class="fu">ada_get_domain</span>(https_domain)) <span class="sc">%&gt;%</span></span>
<span id="cb42-9"><a href="#cb42-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(domain, domain_old) <span class="sc">%&gt;%</span></span>
<span id="cb42-10"><a href="#cb42-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">domain_match =</span> <span class="fu">ifelse</span>(domain <span class="sc">==</span> domain_old, T, F))</span>
<span id="cb42-11"><a href="#cb42-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-12"><a href="#cb42-12" aria-hidden="true" tabindex="-1"></a><span class="do">### News sites defined by domain</span></span>
<span id="cb42-13"><a href="#cb42-13" aria-hidden="true" tabindex="-1"></a>news_domains <span class="ot">&lt;-</span> news_list <span class="sc">%&gt;%</span> </span>
<span id="cb42-14"><a href="#cb42-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(domain_match <span class="sc">==</span> T) <span class="sc">%&gt;%</span></span>
<span id="cb42-15"><a href="#cb42-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(domain) <span class="sc">%&gt;%</span> </span>
<span id="cb42-16"><a href="#cb42-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">news =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-17"><a href="#cb42-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">duplicated</span>(domain))</span>
<span id="cb42-18"><a href="#cb42-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-19"><a href="#cb42-19" aria-hidden="true" tabindex="-1"></a><span class="do">### News sites defined by more than domain (e.g. "yahoo.com/new")</span></span>
<span id="cb42-20"><a href="#cb42-20" aria-hidden="true" tabindex="-1"></a><span class="do">### Change these to a string to be matched with regex</span></span>
<span id="cb42-21"><a href="#cb42-21" aria-hidden="true" tabindex="-1"></a>news_other <span class="ot">&lt;-</span> news_list <span class="sc">%&gt;%</span> </span>
<span id="cb42-22"><a href="#cb42-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(domain_match <span class="sc">==</span> F) <span class="sc">%&gt;%</span></span>
<span id="cb42-23"><a href="#cb42-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(domain_old) <span class="sc">%&gt;%</span> <span class="fu">paste</span>(., <span class="at">collapse =</span> <span class="st">"|"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Then, we match both the list of domains, and the list of domains with paths to the data:</p>
<div class="cell" data-hash="index_cache/html/classify-lists-2-r_ee3a12e8597a845c2f59afa98387fe94">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>dt <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., news_domains, <span class="at">by =</span> <span class="st">"domain"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">news =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(news_other, url), <span class="dv">1</span>, news))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The logic is the same in webtrackR:</p>
<div class="cell" data-hash="index_cache/html/classify-lists-2-webtrackr_f136d4abd48e8c56a99a2adbaecc72f8">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>wt <span class="ot">&lt;-</span> wt <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., news_domains, <span class="at">by =</span> <span class="st">"domain"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">news =</span> <span class="fu">ifelse</span>(<span class="fu">grepl</span>(news_other, url), <span class="dv">1</span>, news))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- TO DO: 

classify by APIs and lists via domainator -->
<!-- Check Gaurav's stuff -->
<!--    https://github.com/themains/bad_domains/ -->
<!--    https://github.com/themains/domain_knowledge -->
<!--    https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/GMNP04 -->
<!--    https://github.com/soodoku/adult -->
<!--    https://github.com/themains/piedomains -->
<!--    https://gsood.com/research/papers/selexp.pdf -->
<!--    https://gojiberries.io/2022/05/15/gathering-domain-knowledge/ -->
<!-- TO DO:

## Classifying by web site content -->
<!-- \paragraph{tidy R} The following R code lets you get titles for URLs with the help of the \texttt{rvest} package. Note that for a large number of URLs, this process can take a while. -->
<!-- ```{r classify-web-site-content} -->
<!-- # library(boilerpipeR) -->
<!-- ``` -->
<!-- TO DO: build classifier -->
</section>
<section id="classifying-by-web-site-titles-or-paths" class="level2">
<h2 class="anchored" data-anchor-id="classifying-by-web-site-titles-or-paths">Classifying by web site titles or paths</h2>
<p><strong>tidy R</strong>. The following R code lets you get titles for URLs with the help of the <code>rvest</code> package. Note that for a large number of URLs, this process can take a while. We therefore test the code with only a small selection of ten URLs. The results show that for a lot of cases, the title cannot be retrieved any more, which is unsurprising given the data collection happened in 2019.</p>
<div class="cell" data-hash="index_cache/html/classifying-titles-tidyr_795e446b3e7a57cefdf23e12b46323cf">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="co"># usually, you would get unique set of URls to speed up the process:</span></span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>urls_unique <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">url =</span> <span class="fu">unique</span>(dt<span class="sc">$</span>url)) </span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-4"><a href="#cb45-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for now, we just get a random sample of ten:</span></span>
<span id="cb45-5"><a href="#cb45-5" aria-hidden="true" tabindex="-1"></a>urls_sample <span class="ot">&lt;-</span> <span class="fu">slice_sample</span>(urls_unique, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb45-6"><a href="#cb45-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-7"><a href="#cb45-7" aria-hidden="true" tabindex="-1"></a><span class="co"># for each URL, get the title (and set to NA if irretrievable)</span></span>
<span id="cb45-8"><a href="#cb45-8" aria-hidden="true" tabindex="-1"></a>urls_sample <span class="ot">&lt;-</span> urls_sample <span class="sc">%&gt;%</span></span>
<span id="cb45-9"><a href="#cb45-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">title =</span> <span class="fu">mapply</span>(<span class="cf">function</span>(x) {</span>
<span id="cb45-10"><a href="#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(</span>
<span id="cb45-11"><a href="#cb45-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">tryCatch</span>({</span>
<span id="cb45-12"><a href="#cb45-12" aria-hidden="true" tabindex="-1"></a>        <span class="fu">print</span>(x)</span>
<span id="cb45-13"><a href="#cb45-13" aria-hidden="true" tabindex="-1"></a>        <span class="fu">html_text</span>(<span class="fu">html_node</span>(<span class="fu">read_html</span>(x), <span class="st">"head title"</span>))</span>
<span id="cb45-14"><a href="#cb45-14" aria-hidden="true" tabindex="-1"></a>      }, <span class="at">error =</span> <span class="cf">function</span>(e) <span class="cn">NA</span>))}, url))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "https://autismup.org/classes"
[1] "https://store.roosterteeth.com/products/rwby-ruby-sketch-t-shirt"
[1] "https://www.socialscour.com/ss3/search/web"
[1] "https://en.wikipedia.org/wiki/The_Perks_of_Being_a_Wallflower_(film)"
[1] "https://www.celebjihad.com/kelly-gale/kelly-gale-nude-and-sexy-photos-compilation"
[1] "https://worker.mturk.com/projects/3VKCYEEK5GMTPFGJS9C31OUU5FB1GV/tasks/3BAKUKE49HYJ95RMQEW5PANEBF0R19"
[1] "https://www.swagbucks.com/watch/video/309595317/it-helps-to-have-dads-advice-when-you-win-a-golden-globe-award"
[1] "https://www.amazon.com/gp/offer-listing/B009SNP2W6/SubscriptionId=AKIAJ7T5BOVUVRD2EFYQ&amp;tag=camelproducts-20&amp;linkCode=xm2&amp;camp=2025&amp;creative=165953&amp;creativeASIN=B009SNP2W6"
[1] "https://old.reddit.com/r/TalesFromTheFrontDesk/comments/bhwubj/guest_was_angry_at_me_because_of_the_security/"
[1] "https://www.instagram.com/tidwell5451/channel/"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># had we done this for all URLs, we could join back to data</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dt &lt;- dt %&gt;%</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   left_join(., urls_unique, by = "url")</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect some results</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>urls_sample <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                                                                                                    url
1                                                                          https://autismup.org/classes
2                                      https://store.roosterteeth.com/products/rwby-ruby-sketch-t-shirt
3                                                            https://www.socialscour.com/ss3/search/web
4                                  https://en.wikipedia.org/wiki/The_Perks_of_Being_a_Wallflower_(film)
5                     https://www.celebjihad.com/kelly-gale/kelly-gale-nude-and-sexy-photos-compilation
6 https://worker.mturk.com/projects/3VKCYEEK5GMTPFGJS9C31OUU5FB1GV/tasks/3BAKUKE49HYJ95RMQEW5PANEBF0R19
                                               title
1                                               &lt;NA&gt;
2                                               &lt;NA&gt;
3                                               &lt;NA&gt;
4 The Perks of Being a Wallflower (film) - Wikipedia
5        Kelly Gale Nude And Sexy Photos Compilation
6                                     Amazon Sign-In</code></pre>
</div>
</div>
<p><strong>webtrackR</strong>. The package wraps the above logic in a function and also allows to set the accepted language of the request. Note that this language setting does not overcome the fact that being in a different country will give you different results.</p>
<div class="cell" data-hash="index_cache/html/classifying-titles-webtrackr_3bb10b08812b3097e5280c9e1f9a9244">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get a random sample of ten rows:</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>wt_sample <span class="ot">&lt;-</span> <span class="fu">slice_sample</span>(wt, <span class="at">n =</span> <span class="dv">10</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># call the function</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>wt_sample <span class="ot">&lt;-</span> <span class="fu">add_title</span>(wt_sample, <span class="at">lang =</span> <span class="st">"en"</span>)</span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a><span class="co"># inspect some results</span></span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>wt_sample <span class="sc">%&gt;%</span> <span class="fu">select</span>(url, title) <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<!-- TO DO: use parsed paths -->
<!-- TO DO: build classifier -->
</section>
</section>
<section id="modeling-browsing-data" class="level1">
<h1>Modeling browsing data</h1>
<p>Browsing data can be modeled at many levels of analysis, e.g., the visit level or the participant-wave level. We start with the easiest case in which the data is aggregated on the participant level and joined to a survey. <!-- Further below, we also look at experimental and panel designs. --></p>
<p><strong>tidy R</strong>. We summarize the number of all news visits and sum the duration of all news visits per person:</p>
<!-- TO DO: Make names consistent -->
<div class="cell" data-hash="index_cache/html/aggregate-tidyr_b50a47234aef9f2664fc4594231c91db">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate number and duration of (news) visits </span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="do">## this assumes you have joined the list of news sites to the data</span></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="do">## ... and that you have a duration variable</span></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a>dt_person <span class="ot">&lt;-</span> dt <span class="sc">%&gt;%</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">news =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(news), <span class="dv">0</span>, news)) <span class="sc">%&gt;%</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(panelist_id, news) <span class="sc">%&gt;%</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">news_n =</span> <span class="fu">n</span>(), </span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">news_sec =</span> <span class="fu">sum</span>(duration, <span class="at">na.rm =</span> T)) <span class="sc">%&gt;%</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">"news"</span>, <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">"news_n"</span>, <span class="st">"news_sec"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(news_n_1, news_sec_1), <span class="sc">~</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(.), <span class="dv">0</span>, .))) <span class="sc">%&gt;%</span></span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">total_n =</span> news_n_1 <span class="sc">+</span> news_n_0, <span class="at">total_sec =</span> news_sec_0 <span class="sc">+</span> news_sec_1) <span class="sc">%&gt;%</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(panelist_id, total_n, total_sec, <span class="at">news_n =</span> news_n_1, <span class="at">news_sec =</span> news_sec_1)</span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>dt_person <span class="ot">&lt;-</span> dt_person <span class="sc">%&gt;%</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(., toy_survey, <span class="at">by =</span> <span class="st">"panelist_id"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>webtrackR</strong>. The package has functions that allows you to derive the same summary:</p>
<div class="cell" data-hash="index_cache/html/aggregate-webtrackr_54863469f70779387c3de0073de147ad">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate number of (news) visits </span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="do">## this assumes you have joined the list of news sites to the data</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>wt_person_n <span class="ot">&lt;-</span> <span class="fu">sum_visits</span>(wt, <span class="at">visit_class =</span> <span class="st">"news"</span>)</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>wt_person_n <span class="ot">&lt;-</span> wt_person_n[, <span class="fu">c</span>(<span class="st">"panelist_id"</span>, <span class="st">"n_visits"</span>, <span class="st">"n_visits_news_1"</span>)]</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a><span class="co"># aggregate duration of (news) visits </span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a><span class="do">## this assumes you have joined the list of news sites to the data</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a><span class="do">## ... and that you have a duration variable</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>wt_person_dur <span class="ot">&lt;-</span> <span class="fu">sum_durations</span>(wt, <span class="at">visit_class =</span> <span class="st">"news"</span>)</span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>wt_person_dur <span class="ot">&lt;-</span> wt_person_dur[, <span class="fu">c</span>(<span class="st">"panelist_id"</span>, <span class="st">"duration_visits"</span>, <span class="st">"duration_visits_news_1"</span>)]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As <code>webtrackR</code> does not offer any functionality for modelling, we proceed with the <code>dt_person</code> object only.</p>
<section id="visits--vs-time-based-exposure" class="level2">
<h2 class="anchored" data-anchor-id="visits--vs-time-based-exposure">Visits- vs time-based exposure</h2>
<p>As we have summarized both duration and visits, we can do both visits-based and time-based modelling. For example, two regressions of political knowledge measured at the last wave (<code>polknow_w4</code>) on sociodemographics, total browsing and news exposure, once in terms of visits and once in terms of time would look like this:</p>
<div class="cell" data-hash="index_cache/html/model-visits-r_db1844812e5b61d5e6a5f7ad0dc513b6">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># visits-based model</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(polknow_w4 <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> edu <span class="sc">+</span> news_n <span class="sc">+</span> total_n, <span class="at">data =</span> dt_person) <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = polknow_w4 ~ age + sex + edu + news_n + total_n, 
    data = dt_person)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.48150 -0.80613  0.02891  0.65293  2.34308 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.655e+00  3.536e-01  10.337  &lt; 2e-16 ***
age          2.323e-03  5.501e-03   0.422  0.67382    
sexmale     -2.615e-01  2.106e-01  -1.242  0.21748    
edulow      -3.034e-01  2.735e-01  -1.109  0.27016    
edumedium   -4.574e-01  2.442e-01  -1.873  0.06423 .  
news_n      -2.560e-04  8.690e-05  -2.946  0.00407 ** 
total_n     -2.377e-05  5.571e-06  -4.266 4.78e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.031 on 93 degrees of freedom
Multiple R-squared:  0.3258,    Adjusted R-squared:  0.2823 
F-statistic: 7.491 on 6 and 93 DF,  p-value: 1.456e-06</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/model-time-r_a066b7f3264ba3551d2c1f3af60aa374">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># time-based model</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(polknow_w4 <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> edu <span class="sc">+</span> news_sec <span class="sc">+</span> total_sec, <span class="at">data =</span> dt_person) <span class="sc">%&gt;%</span> </span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = polknow_w4 ~ age + sex + edu + news_sec + total_sec, 
    data = dt_person)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.18260 -0.62362  0.04638  0.63464  2.27611 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.663e+00  3.390e-01  10.804  &lt; 2e-16 ***
age          1.549e-03  5.293e-03   0.293   0.7705    
sexmale     -2.644e-01  2.030e-01  -1.303   0.1959    
edulow      -2.382e-01  2.618e-01  -0.910   0.3652    
edumedium   -4.926e-01  2.340e-01  -2.105   0.0380 *  
news_sec    -1.767e-05  4.057e-06  -4.356 3.41e-05 ***
total_sec   -5.232e-07  2.087e-07  -2.507   0.0139 *  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.9931 on 93 degrees of freedom
Multiple R-squared:  0.375, Adjusted R-squared:  0.3347 
F-statistic: 9.301 on 6 and 93 DF,  p-value: 5.591e-08</code></pre>
</div>
</div>
</section>
<section id="accounting-for-skewness" class="level2">
<h2 class="anchored" data-anchor-id="accounting-for-skewness">Accounting for skewness</h2>
<p>If we think that the skew of the exposure variable needs to be accounted for by log-transformation, we could apply this transformation before running the model. Specifically, we take the natural log after adding 1 (so that a value of zero does not become undefined).</p>
<div class="cell" data-hash="index_cache/html/skewness-r_0caf0e58a4e042ae077fbe2e1140bc44">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>dt_person <span class="ot">&lt;-</span> dt_person <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">c</span>(news_n, total_n, news_sec, total_sec), <span class="sc">~</span> <span class="fu">log</span>(. <span class="sc">+</span> <span class="dv">1</span>), </span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">.names =</span> <span class="st">"{.col}_log"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="index_cache/html/model-logged-visits-r_bdb3ccd8a9a32d54b91acec6eecb8a68">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># log-transformed exposure (visits)</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(polknow_w4 <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> edu <span class="sc">+</span> news_n_log <span class="sc">+</span> total_n_log, <span class="at">data =</span> dt_person) <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = polknow_w4 ~ age + sex + edu + news_n_log + total_n_log, 
    data = dt_person)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.85944 -0.56743  0.04893  0.48329  2.28713 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  5.077361   0.833504   6.092 2.50e-08 ***
age          0.001496   0.004290   0.349    0.728    
sexmale     -0.166664   0.164114  -1.016    0.312    
edulow      -0.081956   0.213298  -0.384    0.702    
edumedium   -0.225455   0.191448  -1.178    0.242    
news_n_log  -0.391735   0.054315  -7.212 1.44e-10 ***
total_n_log -0.048755   0.101509  -0.480    0.632    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.8046 on 93 degrees of freedom
Multiple R-squared:  0.5897,    Adjusted R-squared:  0.5633 
F-statistic: 22.28 on 6 and 93 DF,  p-value: 4.191e-16</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/model-logged-duration-r_3523a389497a0de605b09dbe12b53a44">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># log-transformed exposure (duration)</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(polknow_w4 <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> edu <span class="sc">+</span> news_sec_log <span class="sc">+</span> total_sec_log, <span class="at">data =</span> dt_person) <span class="sc">%&gt;%</span> </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = polknow_w4 ~ age + sex + edu + news_sec_log + total_sec_log, 
    data = dt_person)

Residuals:
     Min       1Q   Median       3Q      Max 
-1.83086 -0.59240  0.03624  0.51253  2.33847 

Coefficients:
                Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)    5.8064671  1.1611419   5.001 2.68e-06 ***
age            0.0009637  0.0044266   0.218    0.828    
sexmale       -0.0606849  0.1695799  -0.358    0.721    
edulow        -0.1268052  0.2174683  -0.583    0.561    
edumedium     -0.2846867  0.1967174  -1.447    0.151    
news_sec_log  -0.2799361  0.0418323  -6.692 1.64e-09 ***
total_sec_log -0.0614377  0.1062990  -0.578    0.565    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.8284 on 93 degrees of freedom
Multiple R-squared:  0.5651,    Adjusted R-squared:  0.5371 
F-statistic: 20.14 on 6 and 93 DF,  p-value: 5.808e-15</code></pre>
</div>
</div>
</section>
<section id="controlling-for-overall-browsing" class="level2">
<h2 class="anchored" data-anchor-id="controlling-for-overall-browsing">Controlling for overall browsing</h2>
<p>Whether or not we need to control for overall browsing is a theoretical decision, and we can easily run the model with or without that control. Alternatively, we can also create a proportional measure of exposure:</p>
<div class="cell" data-hash="index_cache/html/controlling-r_8be860a26899c8f1f0707c90186acd1e">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>dt_person <span class="ot">&lt;-</span> dt_person <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">news_prop =</span> news_n <span class="sc">/</span> total_n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-hash="index_cache/html/model-no-control-r_7fd98ae69e96b6b9d4ffbf48ef0f768a">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># no control for overall browsing</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(polknow_w4 <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> edu <span class="sc">+</span> news_n, <span class="at">data =</span> dt_person) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = polknow_w4 ~ age + sex + edu + news_n, data = dt_person)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.63183 -0.81035 -0.01082  0.78559  2.79764 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.053e+00  3.526e-01   8.658  1.3e-13 ***
age          3.639e-03  5.974e-03   0.609 0.543932    
sexmale     -2.005e-01  2.285e-01  -0.877 0.382472    
edulow      -1.144e-01  2.935e-01  -0.390 0.697697    
edumedium   -4.211e-01  2.655e-01  -1.586 0.116059    
news_n      -3.637e-04  9.043e-05  -4.021 0.000117 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.122 on 94 degrees of freedom
Multiple R-squared:  0.1939,    Adjusted R-squared:  0.151 
F-statistic: 4.522 on 5 and 94 DF,  p-value: 0.0009733</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/model-control-r_0515cd54712505c2d00cf7d193bec4db">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># control for overall browsing</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(polknow_w4 <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> edu <span class="sc">+</span> news_n <span class="sc">+</span> total_n, <span class="at">data =</span> dt_person) <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = polknow_w4 ~ age + sex + edu + news_n + total_n, 
    data = dt_person)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.48150 -0.80613  0.02891  0.65293  2.34308 

Coefficients:
              Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  3.655e+00  3.536e-01  10.337  &lt; 2e-16 ***
age          2.323e-03  5.501e-03   0.422  0.67382    
sexmale     -2.615e-01  2.106e-01  -1.242  0.21748    
edulow      -3.034e-01  2.735e-01  -1.109  0.27016    
edumedium   -4.574e-01  2.442e-01  -1.873  0.06423 .  
news_n      -2.560e-04  8.690e-05  -2.946  0.00407 ** 
total_n     -2.377e-05  5.571e-06  -4.266 4.78e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.031 on 93 degrees of freedom
Multiple R-squared:  0.3258,    Adjusted R-squared:  0.2823 
F-statistic: 7.491 on 6 and 93 DF,  p-value: 1.456e-06</code></pre>
</div>
</div>
<div class="cell" data-hash="index_cache/html/model-prop-r_e8683a9a4e4d10dbd1d59d8874628f6e">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># proportional measure</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(polknow_w4 <span class="sc">~</span> age <span class="sc">+</span> sex <span class="sc">+</span> edu <span class="sc">+</span> news_prop, <span class="at">data =</span> dt_person) <span class="sc">%&gt;%</span> </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = polknow_w4 ~ age + sex + edu + news_prop, data = dt_person)

Residuals:
     Min       1Q   Median       3Q      Max 
-3.12084 -0.80752  0.00932  0.84083  2.85510 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  2.952685   0.356308   8.287 7.96e-13 ***
age          0.004688   0.006059   0.774 0.440992    
sexmale     -0.178137   0.231886  -0.768 0.444289    
edulow      -0.045496   0.297556  -0.153 0.878806    
edumedium   -0.382742   0.270193  -1.417 0.159920    
news_prop   -8.331447   2.259622  -3.687 0.000379 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1.135 on 94 degrees of freedom
Multiple R-squared:  0.1746,    Adjusted R-squared:  0.1307 
F-statistic: 3.977 on 5 and 94 DF,  p-value: 0.002573</code></pre>
</div>
</div>
<!-- # Causal inference -->
<!-- <!-- TO DO: Power analysis -->
<p>–&gt;</p>
<!-- ## Experimental designs -->
<!-- The toy data also contains a (made-up) experimental treatment variable called `treatment`. Imagine treatment subjects were experimentally encouraged to consume more social media. Before testing whether the treatment had an effects on some outcome, the browsing data can be used to analyze whether subjects complied. We first create a new variable to indicated social media visits, and then count the social media visits per person. Of course, the same could be done in terms of duration, rather than visits. -->
<!-- ```{r experiments-compliance}  -->
<!-- # any visit to Facebook, Twitter, Reddit and Youtube could count as social media -->
<!-- dt <- dt %>% -->
<!--   mutate(sm = ifelse( -->
<!--     domain %in%  c("facebook.com", "twitter.com", "reddit.com", "youtube.com"), 1, 0)) -->
<!-- # plot the distribution of social media visits by treatment group -->
<!-- ``` -->
<!-- TO DO: -->
<!-- ## Panel designs -->



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" role="list">
<div id="ref-bevec2021websm" class="csl-entry" role="listitem">
Bevec, Domen, and Vasja Vehovar. 2021. <span>“A WebSM Study: Web Survey Software 2021.”</span> Faculty of Social Sciences, Centre for Social Informatics.
</div>
<div id="ref-clemm2023analysis" class="csl-entry" role="listitem">
Clemm von Hohenberg, Bernhard, Sebastian Stier, Ana S Cardenal, Andrew Guess, Ericka Menchen-Trevino, and Magdalena Wojcieszak. 2024. <span>“Analysis of Web Browsing Data: A Guide.”</span>
</div>
<div id="ref-clemm2024survey" class="csl-entry" role="listitem">
Clemm von Hohenberg, Bernhard, Tiago Ventura, Magdalena Wojcieszak, Jonathan Nagler, and Joshua Tucker. 2024. <span>“Survey Professionalism: New Evidence from Browsing Data.”</span> 2024.
</div>
<div id="ref-Guess2021" class="csl-entry" role="listitem">
Guess, Andrew M. 2021. <span>“<span class="nocase">(Almost) Everything in Moderation: New Evidence on Americans’ Online Media Diets</span>.”</span> <em>American Journal of Political Science</em> 65 (4): 1007–22. <a href="https://doi.org/10.1111/ajps.12589">https://doi.org/10.1111/ajps.12589</a>.
</div>
<div id="ref-schmidt_mangold_stier_ulloa" class="csl-entry" role="listitem">
Schmidt, Felix, Frank Mangold, Sebastian Stier, and Roberto Ulloa. 2023. <span>“Facebook as an Avenue to News: A Comparison and Validation of Approaches to Identify <span>F</span>acebook Referrals.”</span> SocArXiv. 2023. <a href="https://osf.io/preprints/socarxiv/cks68">osf.io/preprints/socarxiv/cks68</a>.
</div>
<div id="ref-schoch_adar_2023" class="csl-entry" role="listitem">
Schoch, David, and Chung-hong Chan. 2023. <span>“<span class="nocase">adaR</span>: <span>A</span> <span>Fast</span> ’<span>WHATWG</span>’ <span>Compliant</span> <span>URL</span> <span>Parser</span>.”</span> 2023. <a href="https://CRAN.R-project.org/package=adaR">https://CRAN.R-project.org/package=adaR</a>.
</div>
<div id="ref-schoch_webtrackr_2023" class="csl-entry" role="listitem">
Schoch, David, Bernhard Clemm Von Hohenberg, Sebastian Stier, and Frank Mangold. 2023. <span>“<span class="nocase">webtrackR</span>: <span>Analysing</span> <span>Web</span> <span>Tracking</span> <span>Data</span> and <span>Online</span> <span>News</span> <span>Behaviour</span>.”</span> 2023. <a href="https://CRAN.R-project.org/package=webtrackR">https://CRAN.R-project.org/package=webtrackR</a>.
</div>
<div id="ref-stier.apsr.2022" class="csl-entry" role="listitem">
Stier, Sebastian, Frank Mangold, Michael Scharkow, and Johannes Breuer. 2022. <span>“Post Post-Broadcast Democracy? <span>N</span>ews Exposure in the Age of Online Intermediaries.”</span> <em>American Political Science Review</em> 116: 768–74. <a href="https://doi.org/10.1017/S0003055421001222">https://doi.org/10.1017/S0003055421001222</a>.
</div>
<div id="ref-wojcieszak2022null" class="csl-entry" role="listitem">
Wojcieszak, Magdalena, Bernhard Clemm von Hohenberg, Andreu Casas, Ericka Menchen-Trevino, Sjifra de Leeuw, Alexandre Gonçalves, and Miriam Boon. 2022. <span>“Null Effects of News Exposure: A Test of the (Un) Desirable Effects of a ‘News Vacation’and <span>‘News Binging’</span>.”</span> <em>Humanities and Social Sciences Communications</em> 9 (1): 1–10.
</div>
<div id="ref-wojcieszak2023non" class="csl-entry" role="listitem">
Wojcieszak, Magdalena, Ericka Menchen-Trevino, Bernhard Clemm von Hohenberg, Sjifra de Leeuw, João Gonçalves, Sam Davidson, and Alexandre Gonçalves. 2023. <span>“Non-News Websites Expose People to More Political Content Than News Websites: Evidence from Browsing Data in Three Countries.”</span> <em>Political Communication</em>, 1–23.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>